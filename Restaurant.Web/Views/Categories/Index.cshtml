@model IEnumerable<Restaurant.Domain.Entities.Category>

@{
    ViewData["Title"] = "Categories";
    var total = Model?.Count() ?? 0;
    var activeCount = Model?.Count(x => x.IsActive) ?? 0;
}

<div class="page-wrap">
    <div class="container py-4">

        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
            <div>
                <h2 class="mb-1 fw-semibold">Categories</h2>
                <div class="text-muted small">
                    @total categories • @activeCount active
                </div>
            </div>

            <div class="d-flex gap-2">
                <div class="input-group searchbox">
                    <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                    <input id="q" type="text" class="form-control" placeholder="Search categories...">
                </div>

                <select id="status" class="form-select w-auto">
                    <option value="all">All</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>

                <a class="btn btn-primary d-flex align-items-center gap-2" asp-action="Create">
                    <i class="bi bi-plus-lg"></i>
                    <span>Create</span>
                </a>
            </div>
        </div>

        @if (!Model.Any())
        {
            <div class="empty-state text-center p-5 border rounded-4 bg-white">
                <div class="display-6 mb-2"><i class="bi bi-grid-3x3-gap"></i></div>
                <h5 class="mb-2">No categories yet</h5>
                <p class="text-muted mb-4">Create your first category to organize your menu.</p>
                <a class="btn btn-primary" asp-action="Create">
                    <i class="bi bi-plus-lg me-2"></i>Create New Category
                </a>
            </div>
        }
        else
        {
            <div id="grid" class="row g-3">
                @foreach (var c in Model)
                {
                    var badgeClass = c.IsActive ? "text-bg-success" : "text-bg-secondary";
                    var img = string.IsNullOrWhiteSpace(c.ImageUrl)
                    ? "https://via.placeholder.com/600x400?text=Category"
                    : c.ImageUrl;

                    <div class="col-12 col-md-6 col-lg-4 cat-item"
                         data-name="@c.Name?.ToLower()"
                         data-status="@(c.IsActive ? "active" : "inactive")">

                        <div class="card card-hover h-100 border-0 shadow-sm rounded-4 overflow-hidden">

                            <div class="position-relative">
                                <a class="text-decoration-none"
                                   asp-controller="MenuItems"
                                   asp-action="Index"
                                   asp-route-categoryId="@c.Id">
                                    <div class="ratio ratio-16x9">
                                        <img src="@img"
                                             class="w-100 h-100 object-fit-cover"
                                             alt="@c.Name"
                                             onerror="this.onerror=null;this.src='https://via.placeholder.com/600x400?text=No+Image';" />
                                    </div>
                                </a>

                                <div class="cat-actions position-absolute top-0 end-0 p-2 d-flex gap-1">
                                    <a class="btn btn-sm btn-light" asp-action="Edit" asp-route-id="@c.Id" title="Edit">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a class="btn btn-sm btn-light text-danger" asp-action="Delete" asp-route-id="@c.Id" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </div>
                            </div>

                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start gap-2">
                                    <div>
                                        <a class="text-decoration-none text-dark"
                                           asp-controller="MenuItems"
                                           asp-action="Index"
                                           asp-route-categoryId="@c.Id">
                                            <h5 class="card-title mb-1">@c.Name</h5>
                                        </a>

                                        <span class="badge rounded-pill @badgeClass">
                                            <i class="bi @(c.IsActive ? "bi-check-circle" : "bi-pause-circle") me-1"></i>
                                            @(c.IsActive ? "Active" : "Inactive")
                                        </span>
                                    </div>
                                </div>

                                <p class="text-muted mt-3 mb-0 clamp-3">
                                    @(string.IsNullOrWhiteSpace(c.Description) ? "No description provided." : c.Description)
                                </p>
                            </div>

                            <div class="card-footer bg-white border-0 pt-0 pb-3 px-3">
                                <div class="d-grid gap-2">
                                    <a class="btn btn-primary btn-sm d-flex justify-content-center align-items-center gap-2 rounded-pill btn-soft"
                                       asp-controller="MenuItems"
                                       asp-action="Index"
                                       asp-route-categoryId="@c.Id">
                                        <i class="bi bi-list-ul"></i>
                                        <span>Open menu</span>
                                        <i class="bi bi-arrow-right"></i>
                                    </a>

                                    <a class="btn btn-outline-primary btn-sm d-flex justify-content-center align-items-center gap-2 rounded-pill btn-dashed"
                                       asp-controller="MenuItems"
                                       asp-action="Create"
                                       asp-route-categoryId="@c.Id">
                                        <i class="bi bi-plus-circle"></i>
                                        <span>Add item</span>
                                    </a>
                                </div>
                            </div>

                        </div>

                    </div>
                }
            </div>
        }
    </div>
</div>

@section Styles {
    <style>
        .page-wrap {
            background: #f6f7fb;
            min-height: calc(100vh - 56px);
        }

        .searchbox {
            min-width: 260px;
        }

        .card-hover {
            transition: transform .15s ease, box-shadow .15s ease;
        }

            .card-hover:hover {
                transform: translateY(-3px);
                box-shadow: 0 .75rem 1.5rem rgba(0,0,0,.08) !important;
            }

        .clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .empty-state {
            max-width: 520px;
            margin: 0 auto;
        }
    </style>
}

@section Scripts {
    <script>
        (function () {
            const q = document.getElementById('q');
            const status = document.getElementById('status');
            const items = document.querySelectorAll('.cat-item');

            function applyFilter() {
                const term = (q.value || '').trim().toLowerCase();
                const st = status.value;

                items.forEach(el => {
                    const name = el.getAttribute('data-name') || '';
                    const s = el.getAttribute('data-status') || '';
                    const matchTerm = !term || name.includes(term);
                    const matchStatus = (st === 'all') || (s === st);
                    el.style.display = (matchTerm && matchStatus) ? '' : 'none';
                });
            }

            if (q) q.addEventListener('input', applyFilter);
            if (status) status.addEventListener('change', applyFilter);
        })();
    </script>
}
